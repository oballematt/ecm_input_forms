$(document).ready(()=>{$(function(){$("[data-toggle=\"tooltip\"]").tooltip()}),$(".load").on("click",function(){$("#overlay").fadeIn().delay(8e3).fadeOut(),$("html, body").css({overflow:"hidden",height:"100%"})});const a=a=>{var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")},b=$("input[name=\"baseline_start_date\"]"),c=$("input[name=\"reporting_period_start_date\"]");b.datepicker({changeYear:!0}),c.datepicker({changeYear:!0});const d=["building","measure_type","status","staff_lead","staff_colead","analyst"];let e={};$("#formData").on("submit",()=>{d.forEach(a=>e[a]=$("#"+a).val()),sessionStorage.setItem("values",JSON.stringify(e)),sessionStorage.setItem("pid",$(".pid").val())});const f=sessionStorage.getItem("pid"),g=sessionStorage.getItem("values");$("#searchData").on("submit",()=>{sessionStorage.setItem("search",$("#search").val()),sessionStorage.removeItem("pid")});const h=sessionStorage.getItem("search");f?($("#successModal").modal("show"),$(".successMessage").text(`Your Project ID has been successfully created!`),$(".successId").text(`${f}`),$("#search").val(f)):(h||f)&&"null"!==h?$("#search").val(h):$("#search").val("Project ID"),g&&(e=JSON.parse(g),d.forEach(a=>$("#"+a).val(e[a]||"Choose..."))),$(".percent").text(function(a,b){return $(this).text().trim()?parseFloat(100*b).toFixed(0)+"%":void $(this).text("")}),$(".years").text(function(a,b){return $(this).text().trim()?parseFloat(b).toFixed(2):void $(this).text("")}),$(".whole").each(function(){if(!$(this).text().trim())$(this).text("");else{let b=parseFloat($(this).text()).toFixed(0),c=a(b);$(this).text(c)}}),$(".whole_dollar").each(function(){if(!$(this).text().trim())$(this).text("");else{let b="$"+parseFloat($(this).text()).toFixed(0),c=a(b);$(this).text(c)}}),$(".commas").each(function(){let b=$(this).text(),c=a(b);$(this).text(c)});let i=[],j=[],k=$(".costPhase:contains(\"Implementation\")").map((a,b)=>parseInt($(b).siblings(".sumCosts").text().trim().replace(/,/g,""),10)).get(),l=$(".costPhase:contains(\"Annual\")").map((a,b)=>parseInt($(b).siblings(".sumCosts").text().trim().replace(/,/g,""),10)).get(),m=k.reduce((c,a)=>c+a,0),n=l.reduce((c,a)=>c+a,0);$(".impFunds").each(function(){let a=parseInt($(this).text().replace(/,/g,""));i.push(a)}),$(".annFunds").each(function(){let a=parseInt($(this).text().replace(/,/g,""));j.push(a)});let o=i.reduce((c,a)=>c+a,0),p=j.reduce((c,a)=>c+a,0);const q=m-o,r=n-p,s=a(q),t=a(r);1<q&&($(".warning").removeAttr("style"),$(".display").text(`Warning - Total Implem Fundings is less than Total Implem Costs by: $${s} `)),1<r&&($(".warning").removeAttr("style"),$(".display").text(`Warning - Total Annual Fundings is less than Total Annual Costs by: $${t} `)),$("#formData").on("change",["#building","#measure_type"],()=>{const a=parseInt($("#reporting").val().slice(6),10);null===$("#measure_type").val()?($("#measure_type").val(""),$("#reporting").val("")):null===$("#building").val()?$("#building").val(""):a?8<$("#reporting").val().slice(0,2)?$(".pid").val($("#building").val()+" "+(a+1)+" "+$("#measure_type").val()):$(".pid").val($("#building").val()+" "+a+" "+$("#measure_type").val()):$("#reporting").val("")});let u={"#allBtn":".all","#adamBtn":".adam","#amandaBtn":".amanda","#buddyBtn":".buddy","#cedricBtn":".cedric","#daveBtn":".dave","#graceBtn":".grace","#johnBtn":".john","#mattBtn":".matt","#meaganBtn":".meagan","#patBtn":".pat","#richardBtn":".richard","#travisBtn":".travis"};Object.keys(u).forEach(function(a){let b=u[a],c=$(b).attr("name");$(a).on("click",function(){$(b).removeAttr("style"),$("#filterOptions").html(c);"All"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Adam"===c?$(".all, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Amanda"===c?$(".adam, .all, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Buddy"===c?$(".adam, .amanda, .all, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Cedric"===c?$(".adam, .amanda, .buddy, .all, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Dave"===c?$(".adam, .amanda, .buddy, .cedric, .all, .grace, .john, .matt, .meagan, .pat, .richard, .travis").hide():"Grace"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .all, .john, .matt, .meagan, .pat, .richard, .travis").hide():"John"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .all, .matt, .meagan, .pat, .richard, .travis").hide():"Matt"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .all, .meagan, .pat, .richard, .travis").hide():"Meagan"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .all, .pat, .richard, .travis").hide():"Pat"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .all, .richard, .travis").hide():"Richard"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .all, .travis").hide():"Travis"===c?$(".adam, .amanda, .buddy, .cedric, .dave, .grace, .john, .matt, .meagan, .pat, .richard, .all").hide():void 0})});let v={"#numCHW":"#addCHW","#numELE":"#addELE","#numSTM":"#addSTM","#numHHW":"#addHHW","#numGAS":"#addGAS","#numWTR":"#addWTR","#numPeakCHW":"#addPeakCHW","#numLabor":"#addLabor","#numPredCHW":"#addPredCHW","#numPredELE":"#addPredELE","#numPredSTM":"#addPredSTM","#numPredHHW":"#addPredHHW","#numPredGAS":"#addPredGAS","#numPredWTR":"#addPredWTR","#numPredPeakCHW":"#addPredPeakCHW","#numPredLabor":"#addPredLabor","#numMvCHW":"#addMvCHW","#numMvELE":"#addMvELE","#numMvSTM":"#addMvSTM","#numMvHHW":"#addMvHHW","#numMvGAS":"#addMvGAS","#numMvWTR":"#addMvWTR","#numMvPeakCHW":"#addMvPeakCHW","#numMvLabor":"#addMvLabor"};Object.keys(v).forEach(function(a){let b=v[a];$(a).text().trim()&&$(b).hide()}),$(".addBaseline").on("click",function(a){a.preventDefault();let b=$(this).attr("data-comm-name"),c=$(this).attr("name"),d=prompt(`Enter Value for ${c} `),e=d.replace(/,/g,"");$.ajax({url:"/baseline",method:"POST",data:{project_id:h,commodity:b,value:e}}).then(a=>{$(`.editBaseline[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(`.deleteBaseline[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(this).hide(),$(`.showBtn[name=${c}]`).show(),$("#num"+c).text(d)})}),$(".editBaseline").on("click",function(a){a.preventDefault();let b=$(this).attr("id"),c=$(this).attr("data-comm-name"),d=$(this).attr("name"),e=prompt(`Enter new value for ${c}`),f=e.replace(/,/g,"");$(".predictedHhw").append(`<p>[${e}]</p>`);$.ajax({url:"/update/baseline/"+b,method:"POST",data:{project_id:h,commodity:c,value:f}}).then($("#num"+d).text(e),$("#add"+d).val(e))}),$(".deleteBaseline").on("click",function(a){a.preventDefault();const b=$(this).attr("id");let c=$(this).attr("name");$.ajax({url:"/delete/baseline/"+b,method:"DELETE"}).then($("#num"+c).text(""),$(this).hide(),$(`.editBaseline[name=${c}]`).hide(),$("#add"+c).show())}),$(".addPredicted").on("click",function(a){a.preventDefault();let b=$(this).attr("data-comm-name"),c=$(this).attr("name"),d=prompt(`Enter Value for ${c} `),e=d.replace(/,/g,"");$(".predictedWtr").append(`<p>[${d}]</p>`);$.ajax({url:"/savings",method:"POST",data:{project_id:h,commodity:b,phase:"Predicted",value:e}}).then(a=>{$(`.editPredicted[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(`.deletePredicted[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(this).hide(),$(`.showPredBtn[name=${c}]`).show(),$("#numPred"+c).text(d)})}),$(".editPredicted").on("click",function(a){a.preventDefault();let b=$(this).attr("id"),c=$(this).attr("data-comm-name"),d=$(this).attr("name"),e=prompt(`Enter new value for ${c}`),f=e.replace(/,/g,"");$(".predictedLabor").append(`<p>[${e}]</p>`);$.ajax({url:"/update/savings/"+b,method:"POST",data:{project_id:h,phase:"Predicted",commodity:c,value:f}}).then($("#numPred"+d).text(e),$("#addPred"+d).val(e))}),$(".deletePredicted").on("click",function(a){a.preventDefault();const b=$(this).attr("id");let c=$(this).attr("name");$.ajax({url:"/delete/savings/"+b,method:"DELETE"}).then($("#numPred"+c).text(""),$(this).hide(),$(`.editPredicted[name=${c}]`).hide(),$("#addPred"+c).show())}),$(".addMv").on("click",function(a){a.preventDefault();let b=$(this).attr("data-comm-name"),c=$(this).attr("name"),d=prompt(`Enter Value for ${c} `),e=d.replace(/,/g,"");$(".mvHhw").append(`<p>[${d}]</p>`);$.ajax({url:"/savings",method:"POST",data:{project_id:h,commodity:b,phase:"M&V",value:e}}).then(a=>{$(`.editMv[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(`.deleteMv[name=${c}]`).attr({id:a.id,"data-comm-name":b}),$(this).hide(),$(`.showMvBtn[name=${c}]`).show(),$("#numMv"+c).text(d)})}),$(".editMv").on("click",function(a){a.preventDefault();let b=$(this).attr("id"),c=$(this).attr("data-comm-name"),d=$(this).attr("name"),e=prompt(`Enter new value for ${c}`),f=e.replace(/,/g,"");$(".mvWtr").append(`<p>[${e}]</p>`);$.ajax({url:"/update/savings/"+b,method:"POST",data:{project_id:h,phase:"M&V",commodity:c,value:f}}).then($("#numMv"+d).text(e),$("#addMv"+d).val(e))}),$(".deleteMv").on("click",function(a){a.preventDefault();const b=$(this).attr("id");let c=$(this).attr("name");$.ajax({url:"/delete/savings/"+b,method:"DELETE"}).then($("#numMv"+c).text(""),$(this).hide(),$(`.editMv[name=${c}]`).hide(),$("#addMv"+c).show())}),$("#formData").on("click","button.updateCost",function(){const a=$(this).attr("id"),b=$(".imp_or_ann").attr("value"),c=$(".category").attr("value");let d=[],e={project_id:h,imp_or_ann:$(".imp_or_ann").val()||b,category:$(".category").val()||c,cost:$(".cost").val().replace(/,/g,""),hours:$(".hours").val()};if(e.cost||d.push({text:"Please enter a value for costs (if value is unknown, enter 0)"}),e.hours||d.push({text:"Please enter a value for hours (if value is unknown, enter 0)"}),0<d.length)for(var f in d)$("#errors").append("<p style=\"border: 1px solid black; font-weight: bold\">"+d[f].text+"</p>");else $.ajax({url:"/update/costs_hours/"+a,type:"POST",data:e,success:function(){window.location="/ecmforms"}})}),$("#formData").on("click","button.updateFunding",function(){const a=$(this).attr("id"),b=$(".source").attr("value");let c=[],d={project_id:h,commodity:$(".source").val()||b,implementation:$(".implementation").val().replace(/,/g,""),annual:$(".annual").val().replace(/,/g,"")};if(d.implementation||c.push({text:"Please enter a value for implementation (if value is unknown, enter 0)"}),d.annual||c.push({text:"Please enter a value for annual (if value is unknown, enter 0)"}),0<c.length)for(var e in c)$("#errors").append("<p style=\"border: 1px solid black; font-weight: bold\">"+c[e].text+"</p>");else $.ajax({url:"/update/funding/"+a,type:"POST",data:d,success:function(){window.location="/ecmforms"}})}),$("#formData").on("click","button.updateMisc",function(){const a=$(this).attr("id"),b=$(".phase").attr("value"),c=$(".misc_owner").attr("value");let d=[],e={project_id:h,phase:$(".phase").val()||b,misc_owner:$(".misc_owner").val()||c,misc_savings:$(".misc_savings").val().replace(/,/g,"")};if(e.misc_savings||d.push({text:"Please enter a value for Misc Savings (if value is unknown, enter 0)"}),0<d.length)for(var f in d)$("#errors").append("<p style=\"border: 1px solid black; font-weight: bold\">"+d[f].text+"</p>");else $.ajax({url:"/update/miscsavings/"+a,type:"POST",data:e,success:function(){window.location="/ecmforms"}})});const w=$("#tableData"),x=w.find("tbody"),y=x.find("tr").first().clone();w.on("click","button.addRow",function(a){a.preventDefault();let b=[],c={project_id:h,imp_or_ann:$(".imp_or_ann").last().val(),category:$(".category").last().val(),cost:$(".cost").last().val().replace(/,/g,""),hours:$(".hours").last().val()};if($("#errors").text(""),console.log(c),"undefined"!==c.project_id&&c.project_id||b.push({text:"Please define a project ID"}),c.imp_or_ann||b.push({text:"Please select an option for implementation or annual"}),c.category||b.push({text:"Please select an option for category"}),c.cost||b.push({text:"Please enter a value for cost (if value is unknown, enter 0)"}),c.hours||b.push({text:"Please enter a value for hours (if value is unkown, enter 0)"}),0<b.length)for(var d in b)$("#errors").append("<p style=\"border: 1px solid black; font-weight: bold\">"+b[d].text+"</p>");else $.ajax({url:"/costs_hours",type:"POST",data:c}).then(()=>{console.log(c),x.find(":input").prop("disabled",!0).css("background-color","green"),x.append(y.clone()),$("#next").removeAttr("disabled"),$("#link").attr("href","/fundings"),$("#errors").text(""),$(".info").removeAttr("style"),$(".infoMessage").text("Your data was successfully added! Search for your project again to view and edit the data below. Otherwise, continue adding data to the other tables ")})});const z=$("#tableDataF"),A=z.find("tbody"),B=A.find("tr").first().clone();z.on("click","button.addRowF",a=>{a.preventDefault();let b=[],c={project_id:h,source:$(".source").last().val(),implementation:$(".implementation").last().val().replace(/,/g,""),annual:$(".annual").last().val().replace(/,/g,"")};if($("#errorsF").text(""),"undefined"!==c.project_id&&c.project_id||b.push({text:"Please define a project ID"}),c.source||b.push({text:"Please select an option for source"}),c.implementation||b.push({text:"Please enter a value for implementation (if value is unknown, enter 0)"}),c.annual||b.push({text:"Please enter a value for annual (if value is unknown, enter 0)"}),0<b.length)for(var d in b)$("#errorsF").append("<p style=\"border: 1px solid black; font-weight: bold\">"+b[d].text+"</p>");else $.ajax({url:"/funding",type:"POST",data:c}).then(A.find(":input").prop("disabled",!0).css("background-color","green"),A.append(B.clone()),$("#next").removeAttr("disabled"),$("#link").attr("href","/baseline"),$("#errorsF").text(""),$(".info").removeAttr("style"),$(".infoMessage").text("Your data was successfully added! Search for your project again to view and edit the data below. Otherwise, continue adding data to the other tables "))});const C=$("#tableDataM"),D=C.find("tbody"),E=D.find("tr").first().clone();C.on("click","button.addRowM",function(a){a.preventDefault();let b=[],c={project_id:h,phase:$(".phase").last().val(),misc_owner:$(".misc_owner").last().val(),misc_savings:$(".misc_savings").last().val().replace(/,/g,"")};if($("#errorsM").text(""),"undefined"!==c.project_id&&c.project_id||b.push({text:"Please define a project ID"}),c.phase||b.push({text:"Please select an option for phase"}),c.misc_owner||b.push({text:"Please select an option for owner"}),c.misc_savings||b.push({text:"Please enter a value for Misc Savings (if value is unknown, enter 0)"}),0<b.length)for(var d in b)$("#errorsM").append("<p style=\"border: 1px solid black; font-weight: bold\">"+b[d].text+"</p>");else $.ajax({url:"/miscsavings",type:"POST",data:c}).then(D.find(":input").prop("disabled",!0).css("background-color","green"),D.append(E.clone()),$("#next").removeAttr("disabled"),$("#link").attr("href","/baseline"),$("#errorsM").text(""),$(".info").removeAttr("style"),$(".infoMessage").text("Your data was successfully added! Search for your project again to view and edit the data below. Otherwise, continue adding data to the other tables "))}),$(".deleteCostsHours").on("click",function(a){a.preventDefault();const b=$(this).attr("id");$.ajax({url:"/delete/costs_hours/"+b,method:"DELETE"}).then($(this).closest("tr").remove())}),$(".deleteFundings").on("click",function(a){a.preventDefault();const b=$(this).attr("id");$.ajax({url:"/delete/funding/"+b,method:"DELETE"}).then($(this).closest("tr").remove())}),$(".deleteMiscSavings").on("click",function(a){a.preventDefault();const b=$(this).attr("id");$.ajax({url:"/delete/miscsavings/"+b,method:"DELETE"}).then($(this).closest("tr").remove())}),$(".register").on("click",function(){$(".registerMessage").empty();let a={name:$(".registerName").val(),email:$(".registerEmail").val(),password:$(".registerPassword").val(),password2:$(".password2").val()};$.ajax({type:"POST",url:"/register",data:a}).then(function(a){console.log(a),0<a.length?$(".registerMessage").append(`<div class="alert alert-danger" role="alert">
                        ${a[0].text}
                    </div`):$(".registerMessage").append(`
                <div class="alert alert-success" role="alert">
                    Registration successful! Please Login
                </div`)})}),$("#back").on("click",()=>{sessionStorage.removeItem("pid")}),$("#create").on("click",()=>{sessionStorage.removeItem("values")}),$("#delete").on("click",()=>{sessionStorage.removeItem("search")})});